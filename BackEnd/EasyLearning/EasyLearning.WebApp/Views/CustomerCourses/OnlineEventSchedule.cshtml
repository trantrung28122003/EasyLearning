@using EasyLearing.Infrastructure.Data.Entities;
@model EasyLearning.WebApp.Models.CustomerCourseViewModel
@{
    ViewData["Title"] = "OnlineEventSchedule";
    Layout = null;
}

<link rel="stylesheet" href="https://cdn.plyr.io/3.6.8/plyr.css" />
<script src="https://cdn.plyr.io/3.6.8/plyr.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
<link href="~/css/OnlineEventSchedule.css" rel="stylesheet" />
<link href="~/css/test3.css" rel="stylesheet" />
<script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/locale/vi.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/plugin/relativeTime.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<div class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <!-- Navbar Brand-->
        @{
            var countTrainingPartByCourse = Model.TrainingParts
            .Where(tp => tp.CoursesId == Model.Course.Id)
            .Count();

            var listTrainingPartsByCourse = Model.TrainingParts
            .Where(tp => tp.CoursesId == Model.Course.Id)
            .ToList();

            int countCompletedTrainningPartByCourse = 0;
            @foreach (var itemTrainingPartsByCourseEventId in listTrainingPartsByCourse)
            {
                foreach (var itemUserTrainingPartProgress in Model.UserTrainingProgresss)
                {
                    if (itemTrainingPartsByCourseEventId.Id == itemUserTrainingPartProgress.TrainingPartId
                    && itemUserTrainingPartProgress.IsCompleted == true)
                    {
                        countCompletedTrainningPartByCourse = countCompletedTrainningPartByCourse + 1;
                    }
                }
            }
            double percentCompletedByCourse = (double)countCompletedTrainningPartByCourse / countTrainingPartByCourse * 100;
        }
        <a asp-controller="CustomerCourses" asp-action="ListCourseOnlineByUser">
            <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" style="font-size:30px;margin-left: 10px;"><i class="fas fa-arrow-alt-circle-left"></i></button>
        </a>


        <div class="navbar-brand" style="padding-top: 6px">
            <div class="container-circular-progress" style="margin-left:18px">
                <div style="display: flex;">
                    <div class="circular-progress" id="progress-@Model.Course.Id">
                        <span class="progress-value" data-percent="@percentCompletedByCourse"> 0%</span>
                    </div>
                    <div class="complete-course" style="margin-top: 8px">
                        <h6 class="title" style="margin-left: 8px; font-size: 14px; color: #38c9d6"> @countCompletedTrainningPartByCourse / @countTrainingPartByCourse bài học</h6>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar Toggle-->
        <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle" style="margin-left: 12px;"><i class="fas fa-bars"></i></button>
        <!-- Navbar Search-->

        <a id="getnote" class="navbar-brand" style="margin-left: 10px; color: #06BBCC; cursor: pointer; font-size:18px;">
            <i class="far fa-file"></i> Ghi chú
        </a>
        <div class="note" id="noteContainer">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-9">
                        <form>
                            <div class="row g-3">
                                <div class="col-12">
                                    <h3 for="your-message" class="form-label">Thêm ghi chú tại </h3>
                                    <textarea class="form-control" id="your-message" name="your-message" rows="4" required></textarea>
                                </div>
                                <div class="col-12">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <button type="submit" class="btn btn-primary btn-rounded">Thêm ghi chú</button>
                                            <button type="button" class="btn btn-white fw-bold" style="color:#06BBCC">Hủy bỏ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="input-group d-flex justify-content-center">
            <p class="navbar-brand ps-3" style=" color: white; margin-right: 200px ">@Model.Course.CoursesName</p>
        </div>





        <!-- Navbar-->
        <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-cog"></i></a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                    <li><a asp-controller="CustomerCourses" asp-action="ListCourseOnlineByUser" class="dropdown-item">Quay về khóa học</a></li>
                    <li><a class="dropdown-item" href="#!">Hỗ trợ</a></li>
                    <li><hr class="dropdown-divider" /></li>
                    <li><a asp-controller="Home" asp-action="Index" class="dropdown-item">Quay về trang trủ</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">

                        <div class="sb-sidenav-menu-heading">Nội dung khóa học</div>
                        @{
                            var listCourseEventsId = Model.TrainingParts
                            .Where(tp => tp.CoursesId == Model.Course.Id)
                            .Select(tp => tp.EventId)
                            .Distinct()
                            .ToList();
                        }
                        @{
                            bool isFirstTrainingPart = true;
                            var previousItemTrainingPart = Model.TrainingParts.FirstOrDefault();
                        }
                        @foreach (var itemCourseEventId in listCourseEventsId)
                        {
                            @foreach (var itemCourseEvent in Model.CourseEvents)
                            {
                                if (itemCourseEvent.Id == itemCourseEventId)
                                {
                                    <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#collapseLayouts_@itemCourseEventId" aria-expanded="false" aria-controls="collapseLayouts_@itemCourseEventId">
                                        <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div>
                                        @itemCourseEvent.EventName
                                        <div class="sb-sidenav-collapse-arrow"><i class="fas fa-angle-down"></i></div>
                                    </a>

                                    @foreach (var itemTrainingPart in Model.TrainingParts)
                                    {
                                        if (itemTrainingPart.EventId == itemCourseEventId)
                                        {
                                            var matchingUserTrainingPartProgress = Model.UserTrainingProgresss.FirstOrDefault(x => x.TrainingPartId == previousItemTrainingPart.Id);
                                            <div class="collapse collapseContainer" id="collapseLayouts_@itemCourseEventId" aria-labelledby="headingOne" data-bs-parent="#sidenavAccordion">
                                                <nav class="sb-sidenav-menu-nested nav">

                                                    <a class="nav-link" @(isFirstTrainingPart ? "active" : "")" id="@("tab-" + itemTrainingPart.Id)" data-toggle="tab" href="#@(itemTrainingPart.Id)" role="tab" aria-controls="@itemTrainingPart.Id" aria-selected="@(isFirstTrainingPart ? "true" : "false")" ">
                                                        <div id="@("icon-container-" + itemTrainingPart.Id)" class="icon-container-@itemTrainingPart.Id" style="margin-right: 8px">
                                                            @foreach (var userTrainingPartProgress in Model.UserTrainingProgresss)
                                                            {
                                                                if (userTrainingPartProgress.TrainingPartId == itemTrainingPart.Id)
                                                                {
                                                                    @if (matchingUserTrainingPartProgress != null && matchingUserTrainingPartProgress.IsCompleted && !userTrainingPartProgress.IsCompleted)
                                                                    {
                                                                        <i class="fa-solid fa-lock" style="display: none;"></i>
                                                                        <i class="fa-solid fa-square-check" style="display: none;"></i>
                                                                        <i class="fa-solid fa-square"></i>
                                                                    }
                                                                    else if (userTrainingPartProgress.IsCompleted == false)
                                                                    {
                                                                        <i class="fa-solid fa-lock" style="pointer-events: none;"></i>
                                                                        <i class="fa-solid fa-square-check" style="display: none;"></i>
                                                                        <i class="fa-solid fa-square" style="display: none;"></i>
                                                                    }
                                                                    else
                                                                    {
                                                                        <i class="fa-solid fa-lock" style="display: none;"></i>
                                                                        <i class="fa-solid fa-square-check"></i>
                                                                        <i class="fa-solid fa-square" style="display: none;"></i>
                                                                    }
                                                                }
                                                            }
                                                        </div>
                                                        <span>@itemTrainingPart.TrainingPartName</span>
                                                    </a>
                                                </nav>
                                            </div>
                                        }
                                        previousItemTrainingPart = @itemTrainingPart;
                                        isFirstTrainingPart = false;
                                    }
                                }
                            }
                        }
                    </div>
                </div>
            </nav>
        </div>
        @{
            bool isFirstTab = true;
        }
        <div id="layoutSidenav_content">
            @foreach (var itemTrainingPart in Model.TrainingParts)
            {
                if (itemTrainingPart.TrainingPartType == TrainingPartType.Lesson)
                {
                    <div class="tab-pane fade @(isFirstTab  ? "show active" : "")" id="@itemTrainingPart.Id" role="tabpanel" aria-labelledby="@("tab-" + itemTrainingPart.Id)" style="margin-bottom: 12px">
                        <div class="plyr__video-embed">
                            <video controls crossorigin playsinline class="videoPlayer" data-video-name="@itemTrainingPart.VideoUrl" data-trainingpart-id="@itemTrainingPart.Id" data-trainingpart-iscomplete="@itemTrainingPart.IsDeleted.ToString()" class="icon-container-@itemTrainingPart.Id">
                                <source src="@itemTrainingPart.VideoUrl" type="video/mp4" />
                            </video>
                            <div class="card mb-4" style="margin-top: 320px; margin-left: 28px; margin-right: 28px; border-color: #06BBCC; border-radius:30px">
                                <div class="card-body d-flex justify-content-between" style="margin-left: 80px;">
                                    <div>
                                        <h2>@itemTrainingPart.TrainingPartName</h2>
                                        <small style="color:#06BBCC;">Cập nhập tháng @itemTrainingPart.DateChange.Value.Month năm @itemTrainingPart.DateChange.Value.Year </small>
                                    </div>
                                    <div style="margin-top: 15px; margin-right: 80px;">
                                        <button class="btn btn-primary  get-comments" data-trainingpartid="@itemTrainingPart.Id" style="font-size:16px; border-radius:30px; box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3);">
                                            <i class="fas fa-comments"></i><span> Hỏi đáp </span>
                                        </button>
                                        <button class="btn btn-light add-note" data-trainingpartid="@itemTrainingPart.Id" data-courseid="@Model.Course.Id" style="font-size: 16px; border-radius:30px; box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3); margin-left:30px">
                                            <i class="fas fa-plus"></i> Thêm ghi chú tại: <strong class="current-time">00:00</strong>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="tab-pane fade @(isFirstTab  ? "show active" : "")" id="@itemTrainingPart.Id" role="tabpanel" aria-labelledby="@("tab-" + itemTrainingPart.Id)">

                        <section class="p-3 p-md-4 p-xl-5">
                            <div class="container">
                                <div class="card border-light-subtle shadow-sm">
                                    <div class="row g-0">
                                        <div class="col-12 col-md-4">
                                            <img class="img-fluid rounded-start w-100 h-100 object-fit-cover" loading="lazy" src="~/img/about.jpg" alt="BootstrapBrain Logo">
                                        </div>
                                        @foreach (var itemUserTrainingPartProgress in Model.UserTrainingProgresss)
                                        {
                                            if (itemUserTrainingPartProgress.TrainingPartId == itemTrainingPart.Id && !itemUserTrainingPartProgress.IsCompleted)
                                            {
                                                <div class="Notification col-12 col-md-8">
                                                    <div class="card-body p-3 p-md-4 p-xl-5">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <div class="mb-5">

                                                                    <div style="display: flex; justify-content: center; align-items: center;">

                                                                        <i style="font-size: 100px; color: #06BBCC; font-weight: 700;" class="far fa-check-circle"></i> <!-- Đây là biểu tượng -->
                                                                    </div>

                                                                    <h2 class="h1 text-center" style="margin-top: 12px;">Bạn đã sẵn sàng làm bài kiểm tra!</h2>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row gy-3 gy-md-4 overflow-hidden " style="margin-top: 20px;">
                                                            <div class="col-12">
                                                                <p class="text-center">Hãy nhấn nút "Bắt Đầu" để bắt đầu làm bài kiểm tra bài vừa học. Chúc bạn ôn tập hiệu quả!</p>
                                                            </div>
                                                            <div class="col-12">
                                                                <div class="exercise-start-screen d-grid">
                                                                    <button class="exercise-start-button btn bsb-btn-xl btn-primary" style="background-color: #06BBCC; border-color: #06BBCC" type="submit" data-trainingpart-id="@itemTrainingPart.Id" data-trainingpart-iscomplete="@itemTrainingPart.IsDeleted">Bắt đầu</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <p class="mt-5 mb-4">Thông tin của bạn về bài tập</p>
                                                                <div class="d-flex gap-3 flex-column flex-xl-row">
                                                                    <a href="#!" class="btn bsb-btn-xl btn-outline-primary">
                                                                        <span class="ms-2 fs-6">Nhật kí hoạt động</span>
                                                                    </a>
                                                                    <button class="btn btn-primary btn-rounded add-note" data-trainingpartid="@itemTrainingPart.Id" style="font-size: 20px">
                                                                        <i class="fas fa-sticky-note"></i> Ghi chú - Thời gian hiện tại: <span class="current-time">00:00</span>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="NoticeOfRework ol-12 col-md-8 d-none">
                                                    <div class="card-body p-3 p-md-4 p-xl-5">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <div class="mb-5">
                                                                    @{
                                                                        var questionCountByTrainingPartId = Model.ExerciseQuestionsByCourse
                                                                        .Where(x => x.TrainingPartId == itemTrainingPart.Id)
                                                                        .Count();

                                                                    }
                                                                    <div style="display: flex; justify-content: center; align-items: center;">

                                                                        <i style="font-size: 100px; color: #06BBCC; font-weight: 700;" class="far fa-check-circle"></i> <!-- Đây là biểu tượng -->
                                                                    </div>

                                                                    <h2 class="h1 text-center" style="margin-top: 12px;">Bạn đã hoàn thành bài kiểm tra này!</h2>
                                                                    <div style="display: flex; justify-content: center; align-items: center; padding-top: 20px">
                                                                        <progress id="resultProgress_@itemTrainingPart.Id" value="100" max="100" style="--value: 100; --max: 100; max-width: 400px;"></progress>
                                                                    </div>
                                                                    <p class="text-center" style="margin-top: 10px; font-size: 16px; font-weight: bold;" id="resultText_@itemTrainingPart.Id"></p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row gy-3 gy-md-4 overflow-hidden">
                                                            <div class="col-12">

                                                                <p class="text-center">Nếu bạn muốn ôn lại kiến thức trong buổi này ! Hãy nhấn nút làm lại để bắt đầu làm bài. Chúc bạn ôn tập hiệu quả</p>

                                                            </div>
                                                            <div class="col-12">
                                                                <div class="exercise-restart-screen d-grid">
                                                                    <button class="exercise-restart-button btn bsb-btn-xl btn-primary" style="background-color: #06BBCC; border-color: #06BBCC" type="submit" data-trainingpart-id="@itemTrainingPart.Id">Làm lại</button>
                                                                    <small style="text-align: center; margin-top : 12px">khi làm lại thì điểm số của bạn sẽ không được lưu!</small>
                                                                </div>

                                                            </div>
                                                        </div>


                                                        <div class="row">
                                                            <div class="col-12">
                                                                <p class="mb-4" style="padding-top: 5px">Thông tin của bạn về bài tập</p>
                                                                <div class="d-flex gap-2 flex-column flex-xl-row">
                                                                    <a href="#!" class="btn bsb-btn-xl btn-outline-primary">
                                                                        <span class="ms-2 fs-6" id="recentAttemptDate_@itemTrainingPart.Id">
                                                                            Lần làm gần đây nhất vào ngày @itemTrainingPart.DateChange.Value.Day tháng @itemTrainingPart.DateChange.Value.Month năm @itemTrainingPart.DateChange.Value.Year
                                                                        </span>
                                                                    </a>
                                                                    <button class="btn bsb-btn-xl btn-outline-primary get-comments" data-trainingpartid="@itemTrainingPart.Id">
                                                                        <span class="ms-2 fs-6">
                                                                            <i class="fas fa-comments"></i> Hỏi đáp
                                                                        </span>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            }
                                            else if (itemUserTrainingPartProgress.TrainingPartId == itemTrainingPart.Id && itemUserTrainingPartProgress.IsCompleted)
                                            {
                                                <div class="Notification col-12 col-md-8  d-none">
                                                    <div class="card-body p-3 p-md-4 p-xl-5">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <div class="mb-5">

                                                                    <div style="display: flex; justify-content: center; align-items: center;">
                                                                        <!-- Đây là phần tử cha -->
                                                                        <i style="font-size: 100px; color: #06BBCC; font-weight: 700;" class="far fa-check-circle"></i> <!-- Đây là biểu tượng -->
                                                                    </div>

                                                                    <h2 class="h1 text-center" style="margin-top: 12px;">Bạn đã sẵn sàng làm bài kiểm tra!</h2>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row gy-3 gy-md-4 overflow-hidden " style="margin-top: 20px;">
                                                            <div class="col-12">
                                                                <p class="text-center">Hãy nhấn nút "Bắt Đầu" để bắt đầu làm bài kiểm tra bài vừa học. Chúc bạn ôn tập hiệu quả!</p>
                                                            </div>
                                                            <div class="col-12">
                                                                <div class="exercise-start-screen d-grid">
                                                                    <button class="exercise-start-button btn bsb-btn-xl btn-primary" style="background-color: #06BBCC; border-color: #06BBCC" type="submit" data-trainingpart-id="@itemTrainingPart.Id" data-trainingpart-iscomplete="@itemTrainingPart.IsDeleted">Bắt đầu</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <p class="mt-5 mb-4">Or sign in with</p>
                                                                <div class="d-flex gap-3 flex-column flex-xl-row">
                                                                    <a href="#!" class="btn bsb-btn-xl btn-outline-primary">

                                                                        <span class="ms-2 fs-6">Điểm</span>
                                                                    </a>
                                                                    <a href="#!" class="btn bsb-btn-xl btn-outline-primary">

                                                                        <span class="ms-2 fs-6">Hoạt động</span>
                                                                    </a>
                                                                    <a href="#!" class="btn bsb-btn-xl btn-outline-primary">
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="NoticeOfRework ol-12 col-md-8">
                                                    <div class="card-body p-3 p-md-4 p-xl-5">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <div class="mb-5">
                                                                    @{
                                                                        var questionCountByTrainingPartId = Model.ExerciseQuestionsByCourse
                                                                        .Where(x => x.TrainingPartId == itemTrainingPart.Id)
                                                                        .Count();
                                                                        var ListCorrectPercentage = ViewData["ListCorrectPercentage"] as List<(string userTrainingPartProgressId, int correctPercentage)>;
                                                                    }
                                                                    <div style="display: flex; justify-content: center; align-items: center;">

                                                                        <i style="font-size: 100px; color: #06BBCC; font-weight: 700;" class="far fa-check-circle"></i> <!-- Đây là biểu tượng -->
                                                                    </div>

                                                                    <h2 class="h1 text-center" style="margin-top: 12px;">Bạn đã hoàn thành bài kiểm tra này!</h2>
                                                                    @foreach (var itemCorrectPercentage in ListCorrectPercentage)
                                                                    {
                                                                        if (itemCorrectPercentage.userTrainingPartProgressId == itemUserTrainingPartProgress.Id)
                                                                        {
                                                                            <div style="display: flex; justify-content: center; align-items: center; padding-top: 20px">
                                                                                <progress id="resultProgress_@itemTrainingPart.Id" value="100" max="100" style="--value: @itemCorrectPercentage.correctPercentage; --max: 100; max-width: 400px;"></progress>
                                                                            </div>
                                                                        }
                                                                    }
                                                                    <p class="text-center" style="margin-top: 10px; font-size: 16px; font-weight: bold;" id="resultText_@itemTrainingPart.Id">@itemUserTrainingPartProgress.CorrectAnswersCount / @questionCountByTrainingPartId câu trả lời đúng</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row gy-3 gy-md-4 overflow-hidden">
                                                            <div class="col-12">

                                                                <p class="text-center">Nếu bạn muốn ôn lại kiến thức trong buổi này ! Hãy nhấn nút làm lại để bắt đầu làm bài. Chúc bạn ôn tập hiệu quả</p>

                                                            </div>
                                                            <div class="col-12">
                                                                <div class="exercise-restart-screen d-grid">
                                                                    <button class="exercise-restart-button btn bsb-btn-xl btn-primary" style="background-color: #06BBCC; border-color: #06BBCC" type="submit" data-trainingpart-id="@itemTrainingPart.Id">Làm lại</button>
                                                                    <small style="text-align: center; margin-top : 12px">khi làm lại thì điểm số của bạn sẽ không được lưu!</small>
                                                                </div>

                                                            </div>
                                                        </div>


                                                        <div class="row">
                                                            <div class="col-12">
                                                                <p class="mb-4" style="padding-top: 5px">Thông tin của bạn về bài tập</p>
                                                                <div class="d-flex gap-2 flex-column flex-xl-row">
                                                                    <a href="#!" class="btn bsb-btn-xl btn-outline-primary">
                                                                        <span class="ms-2 fs-6" id="recentAttemptDate_@itemTrainingPart.Id">
                                                                            Lần làm gần đây nhất vào ngày @itemUserTrainingPartProgress.DateChange.Value.Day tháng @itemUserTrainingPartProgress.DateChange.Value.Month năm @itemUserTrainingPartProgress.DateChange.Value.Year
                                                                        </span>

                                                                    </a>
                                                                    <button class="btn bsb-btn-xl btn-outline-primary get-comments" data-trainingpartid="@itemTrainingPart.Id">
                                                                        <span class="ms-2 fs-6">
                                                                            <i class="fas fa-comments"></i> Hỏi đáp
                                                                        </span>
                                                                    </button>

                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            }
                                        }


                                        <div class="quiz col-12 col-md-8 d-none">

                                            <div class="col-12">
                                                <div class="mb-5">
                                                    <h2 class="h1 text-center">Bài tập trắc nghiệm ôn tập</h2>
                                                </div>
                                            </div>
                                            <div class="exercise-content">
                                                <div class="exercise-display-container hide">
                                                    <div class="exercise-header">
                                                        <div class="number-of-count" style="margin-left: 12px;">
                                                            <span class="number-of-question "></span>
                                                        </div>
                                                        <div class="timer-div" style="margin-left: 12px;">
                                                            <img src="https://uxwing.com/wp-content/themes/uxwing/download/time-and-date/stopwatch-icon.png" width="20px" />
                                                            <span class="time-left"></span>
                                                        </div>
                                                    </div>
                                                    <div class="exercise-container">
                                                    </div>
                                                    <div class="col-12">
                                                        <button class="next-button btn bsb-btn-xl btn-primary" type="submit" style="margin-left: 25%; width: 50%; margin-top: 50px; margin-bottom: 50px;">Tiếp theo</button>
                                                    </div>

                                                </div>
                                                <div class="score-container hide">
                                                    <div class="user-score"></div>
                                                    <button class="restart"></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                }
                isFirstTab = false;
            }


        </div>
    </div>

    @foreach (var itemTraingPart in Model.TrainingParts)
    {
        <div class="comment-box" id="commentBox_@itemTraingPart.Id">

            <div class="d-flex justify-content-center" style="margin-top: 5px;">
                <button type="button" class="close-comments btn btn-outline-primary btn-rounded" data-trainingpartid="@itemTraingPart.Id"> Đóng cửa sổ</button>
            </div>

            <div class="p-3 m-0 border-0 bd-example" id="commentContainer_@itemTraingPart.Id">
                <div class="card bg-light">
                    <header class="card-header border-0 bg-transparent">
                        @foreach (var itemUser in Model.Users)
                        {
                            if (itemUser.Id == Model.currentUserId)
                            {
                                <img src="https://via.placeholder.com/40x40"
                                     class="rounded-circle me-2" />

                                <a class="fw-semibold text-decoration-none">@itemUser.FullName</a>

                            }
                        }
                    </header>
                    <div class="card-body py-1">
                        <form id="commentForm_@itemTraingPart.Id">
                            <div>
                                <label for="exampleFormControlTextarea1" class="visually-hidden">Comment</label>
                                <textarea class="form-control form-control-sm border border-2 rounded-1"
                                          id="exampleFormControlTextarea1_@itemTraingPart.Id"
                                          style="height: 50px"
                                          placeholder="Add a comment..."
                                          minlength="3"
                                          maxlength="255"
                                          required></textarea>
                            </div>
                            <footer class="card-footer bg-transparent border-0 text-end">
                                <button type="button" class="btn btn-link btn-sm me-2 text-decoration-none">Cancel</button>
                                <button type="submit" class="btn btn-primary btn-sm">Submit</button>
                            </footer>
                        </form>
                    </div>
                </div>

                <aside class="d-flex justify-content-between align-items-center my-4">
                    @{
                        var itemCommentCount = 0;
                        foreach (var itemComment in Model.Comments)
                        {
                            if (itemComment.TrainingPartId == itemTraingPart.Id)
                            {
                                itemCommentCount++;
                                var itemReplyCount = Model.Replies.Where(x => x.CommentId == itemComment.Id).Count();
                                itemCommentCount += itemReplyCount;
                            }
                        }
                    }
                    <h4 class="h6" id="commentCount" style="color: #06BBCC">@itemCommentCount Comments</h4>
                </aside>

                @foreach (var itemComment in Model.Comments)
                {

                    if (itemComment.TrainingPartId == itemTraingPart.Id)
                    {
                        <div class="comments">

                            <section id="comment_@itemTraingPart.Id" class="comment mt-3">
                                <article class="card bg-light">
                                    <header class="card-header border-0 bg-transparent d-flex align-items-center">
                                        <div>
                                            @foreach (var itemUser in Model.Users)
                                            {
                                                if (itemUser.Id == itemComment.UserID)
                                                {
                                                    <img src="https://via.placeholder.com/40x40"
                                                         class="rounded-circle me-2" />

                                                    <a class="fw-semibold text-decoration-none">@itemUser.FullName</a>
                                                }
                                            }
                                            <span class="ms-3 small text-muted comment-time" data-time="@itemComment.DateCreate">2 months ago</span>
                                        </div>
                                    </header>
                                    <div class="card-body py-2 px-3">
                                        @itemComment.ContentComment
                                    </div>
                                    <footer class="card-footer bg-white border-0 py-1 px-3">
                                        <button type="button" class="btn btn-link btn-sm text-decoration-none ps-0">
                                            <i class="bi bi-hand-thumbs-up me-1"></i>thích
                                        </button>
                                        <button type="button" class="btn btn-link btn-sm text-decoration-none reply-btn" data-commentid="@itemComment.Id" data-userId="@itemComment.UserID">
                                            phản hồi
                                        </button>
                                        <button type="button" class="btn btn-link btn-sm text-decoration-none reply-btn">
                                            <i class="fa-solid fa-ellipsis"></i>
                                        </button>
                                    </footer>
                                </article>
                            </section>
                            <div id="replyContainer_@itemComment.Id"></div>
                        </div>

                        <aside>
                            @if (itemComment.Replies.Count != 0)
                            {
                                <button id="toggle-replies-btn-@itemComment.Id" class="toggle-replies-btn btn btn-link btn-sm text-decoration-none ms-2 my-2">
                                    xem @itemComment.Replies.Count phản hồi
                                </button>
                            }
                            else
                            {
                                <button id="toggle-replies-btn-@itemComment.Id" class="toggle-replies-btn btn btn-link btn-sm text-decoration-none ms-2 my-2">
                                </button>
                            }
                            <section id="comment-replies_@itemComment.Id" class="ms-5 ms-md-5" style="display: none;">
                                @foreach (var itemReply in Model.Replies)
                                {
                                    if (itemComment.Id == itemReply.CommentId)
                                    {
                                        <div class="replies">
                                            <article class="card bg-light mb-3">
                                                @foreach (var itemUser in Model.Users)
                                                {
                                                    if (itemUser.Id == itemReply.UserID)
                                                    {
                                                        <header class="card-header border-0 bg-transparent">
                                                            <img src="https://via.placeholder.com/30x30"
                                                                 class="rounded-circle me-2" /><a class="fw-semibold text-decoration-none">@itemUser.FullName</a>
                                                            <span class="ms-3 small text-muted comment-time" data-time="@itemReply.DateCreate">2 months ago</span>
                                                        </header>
                                                    }
                                                }
                                                <div class="card-body py-2 px-3">
                                                    @itemReply.ContentReply
                                                </div>

                                                <footer class="card-footer bg-white border-0 py-1 px-3">
                                                    <button type="button" class="btn btn-link btn-sm text-decoration-none ps-0">
                                                        <i class="bi bi-hand-thumbs-up me-1"></i>thích
                                                    </button>
                                                    <button type="button" class="btn btn-link btn-sm text-decoration-none reply-btn" data-commentid="@itemComment.Id" data-replyid="@itemReply.Id" data-userId="@itemReply.UserID">
                                                        Phản hồi
                                                    </button>
                                                    <button type="button"
                                                            class="btn btn-light btn-sm border rounded-4 ms-2">
                                                        <i class="fa-solid fa-ellipsis"></i>
                                                    </button>
                                                </footer>
                                            </article>
                                            <div id="replyContainer_@itemReply.Id"></div>
                                        </div>
                                    }
                                }
                            </section>

                        </aside>
                    }
                }
            </div>
        </div>
    }
    <div class="note-box" id="note-box">
        <div class="d-flex justify-content-center" style="margin-top: 5px;">
            <button type="button" class="close-notes btn btn-outline-primary btn-rounded"> Đóng cửa sổ</button>
        </div>
        @foreach (var itemNote in Model.Notes)
        {
            <div class="p-3 m-0 border-0 bd-example" style="position: relative;">
                <article class="card bg-light">
                    @{
                        var itemTrainingPartName = Model.TrainingParts.FirstOrDefault(x => x.Id == itemNote.TrainingPartId).TrainingPartName;
                        var itemCourseEventId = Model.TrainingParts.FirstOrDefault(x => x.Id == itemNote.TrainingPartId).EventId;
                        var itemCourseEventName = Model.CourseEvents.FirstOrDefault(x => x.Id == itemCourseEventId).EventName;
                    }
                    <header class="card-header border-0 bg-transparent d-flex align-items-center">
                        <div>
                            <button class="btn btn-primary note-button" style="padding:0 28px; border-radius:16px; margin-right:12px" data-currenttime="@itemNote.Time" data-trainingpartid="@itemNote.TrainingPartId">@itemNote.Time</button>
                            <a class="fw-semibold text-decoration-none note-link" style="cursor: pointer;" data-currenttime="@itemNote.Time" data-trainingpartid="@itemNote.TrainingPartId">@itemTrainingPartName </a>
                        </div>

                        <div class="dropdown ms-auto">
                            <button class="btn btn-link text-decoration-none" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu" style="cursor: pointer;">
                                <li><a class="dropdown-item edit-note" data-noteid="@itemNote.Id">Sửa lại ghi chú</a></li>
                                <li><a class="dropdown-item delete-note">Xóa ghi chú</a></li>
                            </ul>

                        </div>
                    </header>
                    <header class="card-header border-0 bg-transparent d-flex align-items-center">
                        <span class="ms-3 small text-muted">@itemCourseEventName</span>
                    </header>
                    <footer class="card-footer bg-white border-0 py-1 px-3">
                        <div class="card-body py-2 px-3" style="font-size:18px">
                            @itemNote.NoteContent
                        </div>
                    </footer>
                </article>

                <div class="modal-delete custom-modal-delete">
                    <div class="modal-content delete-confirmation-form" style="display: none;">
                        <p>Xóa ghi chú này?</p>
                        <div class="button-container">
                            <button class="btn btn-primary confirm-delete" data-noteid="@itemNote.Id">Xóa</button>
                            <button class="btn btn-secondary cancel-delete">Hủy</button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="~/js/OnlineEventScheduleScripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
    @* <script src="~/assets/demo/chart-area-demo.js"></script>
    <script src="~/assets/demo/chart-bar-demo.js"></script>  *@
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js" crossorigin="anonymous"></script>
    <script src="~/js/OnlineEventScheduleDatatablesSimple.js"></script>
    <script src="~/js/OnlineVideoYoutube.js"></script>
    <script src="~/js/QuizTrainingPart.js"></script>
    <script src="~/js/TrackVideoEvent.js"></script>
    <script src="~/js/TabpaneClickShowOrHide.js"></script>
    <script src="~/js/CircleProgress.js"></script>
    <script src="~/js/commnentbytrainingpart.js"></script>
    <script src="~/js/note.js"></script>
</div>


<style>
    .comment-box {
        position: fixed;
        top: 56px;
        right: 0;
        max-height: calc(100% - 40px); /* Chiếm nửa màn hình bên phải */
        height: 100%; /* Chiếm toàn bộ chiều cao màn hình */
        background: #fff;
        border-left: 1px solid #ccc;
        display: none;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000; /* Để khung chat luôn nằm trên */
        overflow-y: auto;
        width: 40%;
    }
</style>

<style>
    .note-box {
        position: fixed;
        top: 56px;
        right: 0;
        max-height: calc(100% - 40px); /* Chiếm nửa màn hình bên phải */
        height: 100%; /* Chiếm toàn bộ chiều cao màn hình */
        background: #fff;
        border-left: 1px solid #ccc;
        display: none;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000; /* Để khung chat luôn nằm trên */
        overflow-y: auto;
        width: 40%;
    }
</style>


<style>
    .custom-modal-delete {
        position: absolute;
        top: 16px; /* Vị trí trên cùng */
        right: 16px; /* Vị trí bên phải */
        z-index: 1050; /* Đảm bảo modal nằm trên các thành phần khác */
        width: 180px;
    }

        .custom-modal-delete .modal-content {
            background: #fff;
            border-radius: 5px;
            padding: 12px;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3); /* Thêm bóng viền */
            display: flex;
            flex-direction: column; /* Đặt layout của nội dung modal thành cột */
            align-items: center; /* Căn giữa theo chiều ngang */
        }

            .custom-modal-delete .modal-content p {
                margin-bottom: 10px;
            }

        .custom-modal-delete .button-container {
            display: flex;
            justify-content: space-between; /* Đặt các phần tử button ở hai bên của modal */
            width: 100%; /* Chiều rộng của button container */
        }

        .custom-modal-delete .modal-content .btn {
            font-size: 12px;
        }

        .custom-modal-delete .btn-primary {
            margin-right: auto; /* Đặt margin-right thành auto để nút "Lưu" nằm bên trái */
        }

        .custom-modal-delete .btn-secondary {
            margin-left: auto; /* Đặt margin-left thành auto để nút "Hủy" nằm bên phải */
        }

</style>
<style>
    /* Đổi màu của nút và văn bản khi di chuột vào */
    .btn-outline-primary:hover, .btn-outline-primary:hover small {
        color: #fff;
        background-color: #06BBCC;
        border-color: #06BBCC;
    }

    /* Đổi màu của văn bản trong các nút */
    .btn-outline-primary {
        color: #06BBCC;
        border-color: #06BBCC;
    }

        /* Đổi màu của văn bản trong các thẻ small */
        .btn-outline-primary small {
            color: color();
        }
</style>

<style>
    .note {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 33%; /* Chiếm 1/3 chiều cao */
        background-color: white;
        border-top: 1px solid #ccc;
        padding: 20px;
        display: none;
    }
</style>



