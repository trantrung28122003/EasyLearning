@model EasyLearning.WebApp.Models.CustomerCourseViewModel

@{
    ViewData["Title"] = "EventSchedule";
    
}

<link href="~/css/customerCoursesSchedule.css" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

<div class="event-schedule-area-two bg-color ">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-header">
                <div class="section-title text-center">
                    <div class="title-text">
                        <h2 class="h2-text-center">Thời khóa biểu cho các khóa học của bạn</h2>
                    </div>
                    <p>
                        Hãy nhớ đi học 
                    </p>
                </div>
            </div>
            <!-- /.col end-->
        </div> 
        <!-- row end-->
        <div class="row">
            <div class="col-lg-12">
                @{
                    bool isFirstCourse = true;
                }
                <ul class="nav custom-tab" id="myTab" role="tablist">
                    @foreach (var item in Model.Courses)
                    {
                        <li class="nav-item">
                            <a class="nav-link @(isFirstCourse ? "active" : "")" id="@("tab-" + item.Id)" data-toggle="tab" href="#@(item.Id)" role="tab" aria-controls="@item.Id" aria-selected="@(isFirstCourse ? "true" : "false")" style="color: #2bc5d4">@item.CoursesName</a>
                        </li>
                        isFirstCourse = false;
                    }
           
                </ul>
                @{
                    bool isFirstCourse1 = true;
                }
                <div class="tab-content" id="myTabContent">
                     @foreach (var item in Model.Courses)
                    {
                        <div class="tab-pane fade @(isFirstCourse1 ? "show active" : "")" id="@item.Id" role="tabpanel" aria-labelledby="@("tab-" + item.Id)">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th class="text-center" scope="col">Date</th>
                                            <th scope="col">Speakers</th>
                                            <th scope="col">Session</th>
                                            <th scope="col">Venue</th>
                                            <th class="text-center" scope="col">Venue</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var itemTraningPart in Model.TranningParts)
                                        {
                                            @if (itemTraningPart.CoursesId == item.Id)
                                            {
                                                <tr class="inner-box">
                                                    <th scope="row">
                                                        <div class="event-date">
                                                            <span>@itemTraningPart.StartTime.Day</span>
                                                            @{
                                                                @using System.Globalization
                                                                // Lấy tên của tháng từ số tháng
                                                                string monthName = CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(itemTraningPart.StartTime.Month);
                                                            }
                                                            <p>@monthName</p>
                                                        </div>
                                                    </th>
                                                    <td>
                                                        <div class="event-img">
                                                            <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" />
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="event-wrap">
                                                            <h3><a href="#">@itemTraningPart.TranningPartName</a></h3>
                                                            <div class="meta">
                                                                <div class="organizers">
                                                                    <a href="#">Aslan Lingker</a>
                                                                </div>
                                                                <div class="categories">
                                                                    <a href="#">Inspire</a>
                                                                </div>
                                                                
                                                                @foreach(var itemCourseEvent in Model.CourseEvents)
                                                                {
                                                                    if(itemCourseEvent.Id == itemTraningPart.EventId)
                                                                    {
                                                                    <div class="time">
                                                                            @{
                                                                                // Lấy giờ bắt đầu và kết thúc từ các thuộc tính DateStart và DateEnd
                                                                                DateTime startTime = itemCourseEvent.DateStart;
                                                                                DateTime endTime = itemCourseEvent.DateEnd;

                                                                                // Định dạng thời gian theo AM/PM và chuỗi dạng hh:mm tt
                                                                                string startTimeFormatted = startTime.ToString("hh:mm tt", CultureInfo.InvariantCulture);
                                                                                string endTimeFormatted = endTime.ToString("hh:mm tt", CultureInfo.InvariantCulture);

                                                                                // Tính khoảng thời gian giữa hai thời điểm
                                                                                TimeSpan duration = endTime - startTime;
                                                                                string durationFormatted = duration.ToString(@"h\h\ m\m", CultureInfo.InvariantCulture);
                                                                            }
                                                                            <span>@startTimeFormatted - @endTimeFormatted @durationFormatted</span>
                                                                    </div>
                                                                    }
                                                                }
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="r-no">
                                                            @foreach (var itemCourseEvent in Model.CourseEvents)
                                                            {
                                                                if (itemCourseEvent.Id == itemTraningPart.EventId)
                                                                {
                                                                    <span>@itemCourseEvent.Location</span>
                                                                }
                                                            }
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="primary-btn">
                                                            <a class="btn btn-primary" href="#">Read More</a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        isFirstCourse1 = false;
                     } 
   
                </div>
            </div>
        </div>

<script>
    // Bắt sự kiện click trên các tab
    document.querySelectorAll('.nav-link').forEach(tab => {
        tab.addEventListener('click', function (e) {
            //e.preventDefault(); // Ngăn chặn hành động mặc định của thẻ a
            const targetId = this.getAttribute('href').replace('#', ''); // Lấy id của tab được chọn
            showTab(targetId); // Hiển thị tab tương ứng
        });
    });

    // Hàm hiển thị tab tương ứng
    function showTab(tabId) {
        // Ẩn tất cả các tab
        document.querySelectorAll('.tab-pane').forEach(tab => {
            tab.classList.remove('show', 'active');
        });
        // Hiển thị tab được chọn
        document.getElementById(tabId).classList.add('show', 'active');

        // Đặt thuộc tính aria-selected
        document.querySelectorAll('.nav-link').forEach(tab => {
            tab.setAttribute('aria-selected', 'false');
        });
        document.querySelector('[href="#' + tabId + '"]').setAttribute('aria-selected', 'true');
    }
</script>